#include <at89x051.h>
#include "uart.h"
#include "softuart.h"
#include "baudot.h"

void softuart_timer_isr (void) __interrupt(1);
void uart_isr (void) __interrupt (4) __using(2);

void main (void) {
  int c;
  
  P3 = 0x03;
  P1 = 0x80;

  UART_Open();
  softuart_init();
  EA=1;

  while (1) {
	if (UART_DataInReceiveBuffer()) {
	  c = UART_Receive();
	  UART_Transmit(c);
	  softuart_putchar(c);
	}

	if (softuart_kbhit()) {
	  c = softuart_getchar();
	  softuart_putchar(c);
	  UART_Transmit(c);
	}
 
 /*
	if ( softuart_kbhit() ) {
      c = softuart_getchar();
      c = baudot_to_ascii(c);
      if (c) uart_putchar(c);
    }

    if ( (c=uart_getchar()) > 0 ) {
      tty_putchar(c);
    }
*/	
  }
}


